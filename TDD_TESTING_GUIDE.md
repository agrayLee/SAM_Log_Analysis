# å±±å§†æ—¥å¿—ç³»ç»Ÿ - TDDæµ‹è¯•æŒ‡å—

> ç‰ˆæœ¬: 1.0.0
> æ›´æ–°æ—¶é—´: 2025-01-17
> éµå¾ª: CLAUDE.mdå¼€å‘è§„èŒƒ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›å®Œæ•´çš„TDDï¼ˆæµ‹è¯•é©±åŠ¨å¼€å‘ï¼‰æµ‹è¯•æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…å’Œæµ‹è¯•äººå‘˜ç‹¬ç«‹éªŒè¯ç³»ç»ŸåŠŸèƒ½ã€‚

### è®¾è®¡ç†å¿µ

- **ç™½ç›’æµ‹è¯•**: å®Œå…¨é€æ˜çš„æµ‹è¯•è¿‡ç¨‹ï¼Œå¯æŸ¥çœ‹æ¯ä¸ªæ¨¡å—çš„å†…éƒ¨å®ç°
- **ç‹¬ç«‹è¿è¡Œ**: æµ‹è¯•ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒå®Œå…¨åˆ†ç¦»
- **Mockä¼˜å…ˆ**: æä¾›å®Œæ•´çš„Mockæ•°æ®å’ŒAPIï¼Œæ— éœ€ä¾èµ–çœŸå®åç«¯
- **æ¨¡å—åŒ–**: æ¯ä¸ªåŠŸèƒ½æ¨¡å—éƒ½å¯ä»¥ç‹¬ç«‹æµ‹è¯•

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æ‰“å¼€æµ‹è¯•é¡µé¢

```bash
# åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
file:///D:/CursorWorkstation/log_analysis/test.html

# æˆ–è€…é€šè¿‡æœ¬åœ°æœåŠ¡å™¨è®¿é—®ï¼ˆæ¨èï¼‰
# å¦‚æœç³»ç»Ÿæ­£åœ¨è¿è¡Œï¼Œè®¿é—®:
http://localhost:3001/test.html
```

### 2. è¿è¡Œå¿«é€ŸéªŒè¯

1. ç‚¹å‡»é¡µé¢åº•éƒ¨ **"ç»¼åˆé›†æˆæµ‹è¯•"** åŒºåŸŸ
2. ç‚¹å‡» **"å¿«é€ŸéªŒè¯æµ‹è¯•"** æŒ‰é’®
3. æŸ¥çœ‹æµ‹è¯•ç»“æœï¼Œç¡®ä¿æ‰€æœ‰MockåŠŸèƒ½æ­£å¸¸

### 3. ç”Ÿæˆæµ‹è¯•æ•°æ®

1. æ‰¾åˆ° **"Mockæ•°æ®ç®¡ç†å·¥å…·"** åŒºåŸŸ
2. ç‚¹å‡» **"ç”Ÿæˆæµ‹è¯•æ•°æ®"** æŒ‰é’®
3. ç‚¹å‡» **"æŸ¥çœ‹Mockæ•°æ®"** éªŒè¯æ•°æ®ç”ŸæˆæˆåŠŸ

## ğŸ§ª æµ‹è¯•æ¨¡å—è¯´æ˜

### 1. APIè¿æ¥æµ‹è¯•

**ç›®çš„**: éªŒè¯ç³»ç»ŸAPIæœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ

**æµ‹è¯•å†…å®¹**:
- âœ… APIæœåŠ¡å™¨è¿æ¥çŠ¶æ€
- âœ… ç³»ç»Ÿå¥åº·æ£€æŸ¥
- âœ… æœåŠ¡å™¨å“åº”æ—¶é—´

**ä½¿ç”¨æ–¹æ³•**:
```javascript
// æµ‹è¯•APIè¿æ¥
testAPIConnection()

// æµ‹è¯•å¥åº·æ£€æŸ¥
testHealthCheck()
```

**é¢„æœŸç»“æœ**:
- è¿”å›çŠ¶æ€ç  200
- database çŠ¶æ€ä¸º 'connected'
- æ˜¾ç¤ºç³»ç»Ÿç‰ˆæœ¬å’Œè¿è¡Œæ—¶é—´

### 2. è®¤è¯æ¨¡å—æµ‹è¯•

**ç›®çš„**: éªŒè¯ç”¨æˆ·ç™»å½•å’Œç™»å‡ºåŠŸèƒ½

**æµ‹è¯•å†…å®¹**:
- âœ… ç”¨æˆ·ç™»å½•éªŒè¯
- âœ… ç”¨æˆ·ç™»å‡ºåŠŸèƒ½
- âœ… Sessionç®¡ç†

**ä½¿ç”¨æ–¹æ³•**:
```javascript
// æµ‹è¯•ç™»å½•ï¼ˆä½¿ç”¨é»˜è®¤è´¦å·ï¼‰
testLogin()

// æµ‹è¯•ç™»å‡º
testLogout()
```

**æµ‹è¯•è´¦å·**:
- ç”¨æˆ·å: `admin`
- å¯†ç : `admin123`

### 3. æ—¥å¿—æŸ¥è¯¢æ¨¡å—æµ‹è¯•

**ç›®çš„**: éªŒè¯æ—¥å¿—è®°å½•æŸ¥è¯¢åŠŸèƒ½

**æµ‹è¯•å†…å®¹**:
- âœ… è½¦ç‰Œå·æŸ¥è¯¢
- âœ… åˆ†é¡µåŠŸèƒ½
- âœ… æŸ¥è¯¢ç»“æœå±•ç¤º
- âœ… Mockæ•°æ®æŸ¥è¯¢

**ä½¿ç”¨æ–¹æ³•**:
```javascript
// å®é™…APIæŸ¥è¯¢
testLogQuery()

// ä½¿ç”¨Mockæ•°æ®æµ‹è¯•
testLogQueryWithMock()
```

**æµ‹è¯•æŠ€å·§**:
- è¾“å…¥å®Œæ•´è½¦ç‰Œå·: `é—½A12345`
- è¾“å…¥éƒ¨åˆ†è½¦ç‰Œå·: `é—½A`ï¼ˆæ¨¡ç³Šæœç´¢ï¼‰
- ç•™ç©ºæŸ¥è¯¢æ‰€æœ‰è®°å½•

### 4. æ•°æ®å¯¼å‡ºæ¨¡å—æµ‹è¯•

**ç›®çš„**: éªŒè¯CSVæ•°æ®å¯¼å‡ºåŠŸèƒ½

**æµ‹è¯•å†…å®¹**:
- âœ… CSVæ ¼å¼å¯¼å‡º
- âœ… æ•°æ®å®Œæ•´æ€§
- âœ… Mockæ•°æ®å¯¼å‡º

**ä½¿ç”¨æ–¹æ³•**:
```javascript
// å®é™…æ•°æ®å¯¼å‡º
testExportData()

// Mockæ•°æ®å¯¼å‡º
testExportWithMock()
```

### 5. Mockæ•°æ®ç®¡ç†å·¥å…·

**ç›®çš„**: æä¾›ç‹¬ç«‹çš„æµ‹è¯•æ•°æ®ç”Ÿæˆå’Œç®¡ç†

**åŠŸèƒ½**:
- âœ… ç”Ÿæˆæµ‹è¯•æ—¥å¿—è®°å½•
- âœ… ç”Ÿæˆæµ‹è¯•ç”¨æˆ·æ•°æ®
- âœ… æŸ¥çœ‹å½“å‰Mockæ•°æ®
- âœ… æ¸…ç©ºMockæ•°æ®
- âœ… ä¸‹è½½Mockæ•°æ®ï¼ˆJSONæ ¼å¼ï¼‰

**ä½¿ç”¨æ–¹æ³•**:
```javascript
// ç”Ÿæˆ20æ¡æ—¥å¿—è®°å½•
MockDataManager.generateLogRecords(20)

// ç”Ÿæˆç”¨æˆ·æ•°æ®
MockDataManager.generateUsers()

// è·å–æ•°æ®
MockDataManager.getData('logRecords')

// æ¸…ç©ºæ•°æ®
MockDataManager.clear()

// å¯¼å‡ºæ•°æ®
MockDataManager.export()
```

### 6. ç»¼åˆé›†æˆæµ‹è¯•

**ç›®çš„**: ä¸€é”®éªŒè¯æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½

**æµ‹è¯•å†…å®¹**:
- âœ… ç³»ç»Ÿå¥åº·æ£€æŸ¥
- âœ… APIçŠ¶æ€éªŒè¯
- âœ… MockåŠŸèƒ½éªŒè¯
- âœ… å„æ¨¡å—ååŒå·¥ä½œ

**ä½¿ç”¨æ–¹æ³•**:
```javascript
// è¿è¡Œæ‰€æœ‰æµ‹è¯•
runAllTests()

// å¿«é€ŸéªŒè¯æµ‹è¯•
runQuickTest()
```

## ğŸ“š æ ¸å¿ƒAPIè¯´æ˜

### MockDataManager - Mockæ•°æ®ç®¡ç†å™¨

```javascript
const MockDataManager = {
    // ç”Ÿæˆæ—¥å¿—è®°å½•
    generateLogRecords: function(count) {
        // è¿”å›: Array<LogRecord>
    },

    // ç”Ÿæˆç”¨æˆ·æ•°æ®
    generateUsers: function() {
        // è¿”å›: Array<User>
    },

    // è·å–æ•°æ®
    getData: function(type) {
        // å‚æ•°: 'logRecords' | 'users' | 'apiResponses'
        // è¿”å›: Array
    },

    // æ¸…ç©ºæ•°æ®
    clear: function() {},

    // å¯¼å‡ºä¸ºJSON
    export: function() {
        // è¿”å›: JSONå­—ç¬¦ä¸²
    },

    // æµ‹è¯•æ–¹æ³•
    test: function() {}
}
```

### MockAPI - Mock APIå·¥å…·

```javascript
const MockAPI = {
    // æ¨¡æ‹Ÿå»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰
    delay: 500,

    // ç™»å½•API
    login: function(username, password, callback) {},

    // ç™»å‡ºAPI
    logout: function(callback) {},

    // æŸ¥è¯¢æ—¥å¿—API
    queryLogs: function(params, callback) {},

    // å¥åº·æ£€æŸ¥API
    healthCheck: function(callback) {},

    // æµ‹è¯•æ–¹æ³•
    test: function() {}
}
```

### APIClient - APIå®¢æˆ·ç«¯

```javascript
const APIClient = {
    baseURL: 'http://localhost:3001',

    // GETè¯·æ±‚
    get: async function(url) {
        // è¿”å›: Promise<Response>
    },

    // POSTè¯·æ±‚
    post: async function(url, data) {
        // è¿”å›: Promise<Response>
    },

    // æµ‹è¯•æ–¹æ³•
    test: async function() {}
}
```

## ğŸ¯ TDDå¼€å‘æµç¨‹

### ç¬¬1æ­¥: ç¼–å†™æµ‹è¯•ç”¨ä¾‹

åœ¨`test.js`ä¸­ä¸ºæ–°åŠŸèƒ½æ·»åŠ æµ‹è¯•å‡½æ•°ï¼š

```javascript
async function testNewFeature() {
    TestUtils.updateResult('test-result', 'æµ‹è¯•ä¸­...', 'running');

    try {
        // æµ‹è¯•é€»è¾‘
        const result = await APIClient.get('/api/new-feature');

        if (result.success) {
            TestUtils.updateResult('test-result',
                '<span class="status-badge pass">æµ‹è¯•é€šè¿‡</span>',
                'success');
        } else {
            TestUtils.updateResult('test-result',
                '<span class="status-badge fail">æµ‹è¯•å¤±è´¥</span>',
                'error');
        }
    } catch (error) {
        TestUtils.updateResult('test-result',
            `é”™è¯¯: ${error.message}`,
            'error');
    }
}
```

### ç¬¬2æ­¥: æ·»åŠ Mockæ•°æ®

å¦‚æœéœ€è¦Mockæ•°æ®æ”¯æŒï¼š

```javascript
// åœ¨MockDataManagerä¸­æ·»åŠ æ–°çš„ç”Ÿæˆæ–¹æ³•
generateNewData: function() {
    const data = [];
    // ç”Ÿæˆé€»è¾‘
    this.data.newDataType = data;
    return data;
}
```

### ç¬¬3æ­¥: åœ¨test.htmlä¸­æ·»åŠ æµ‹è¯•æŒ‰é’®

```html
<div class="test-section">
    <h3>æ–°åŠŸèƒ½æµ‹è¯•</h3>
    <div class="test-controls">
        <button class="test-button" onclick="testNewFeature()">
            æµ‹è¯•æ–°åŠŸèƒ½
        </button>
    </div>
    <div id="test-result" class="test-result">ç­‰å¾…æµ‹è¯•...</div>
</div>
```

### ç¬¬4æ­¥: è¿è¡Œæµ‹è¯•éªŒè¯

1. åˆ·æ–°test.htmlé¡µé¢
2. ç‚¹å‡»æµ‹è¯•æŒ‰é’®
3. æŸ¥çœ‹æµ‹è¯•ç»“æœ
4. æ ¹æ®ç»“æœè°ƒæ•´ä»£ç 

### ç¬¬5æ­¥: é›†æˆåˆ°ä¸»ç³»ç»Ÿ

ç¡®è®¤æµ‹è¯•é€šè¿‡åï¼Œå†å°†åŠŸèƒ½é›†æˆåˆ°ä¸»ç³»ç»Ÿä¸­ã€‚

## ğŸ“Š æµ‹è¯•æ•°æ®æ ¼å¼

### æ—¥å¿—è®°å½•æ ¼å¼

```javascript
{
    id: 1,
    plate_number: 'é—½A12345',
    call_time: '2025-01-17 10:30:00',
    response_time: '2025-01-17 10:30:02',
    free_parking: true,
    reject_reason: '',
    file_source: 'JieLink_Center_Comm_20250117.log',
    created_at: '2025-01-17T10:30:05.000Z'
}
```

### ç”¨æˆ·æ•°æ®æ ¼å¼

```javascript
{
    id: 1,
    username: 'admin',
    role: 'admin',
    email: 'admin@test.com'
}
```

### APIå“åº”æ ¼å¼

```javascript
{
    success: true,
    data: { /* å®é™…æ•°æ® */ },
    message: 'æ“ä½œæˆåŠŸ'
}
```

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1: æµ‹è¯•é¡µé¢æ— æ³•åŠ è½½

**åŸå› **: æµè§ˆå™¨è·¨åŸŸé™åˆ¶

**è§£å†³**:
1. ä½¿ç”¨æœ¬åœ°æœåŠ¡å™¨è®¿é—®ï¼ˆæ¨èï¼‰
2. æˆ–åœ¨æµè§ˆå™¨ä¸­ç¦ç”¨CORSæ£€æŸ¥ï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰

### é—®é¢˜2: APIè¿æ¥å¤±è´¥

**åŸå› **: åç«¯æœåŠ¡æœªå¯åŠ¨

**è§£å†³**:
```bash
# å¯åŠ¨åç«¯æœåŠ¡
npm start

# ç¡®è®¤æœåŠ¡è¿è¡Œ
curl http://localhost:3001/health
```

### é—®é¢˜3: Mockæ•°æ®æµ‹è¯•å¤±è´¥

**åŸå› **: æœªå…ˆç”ŸæˆMockæ•°æ®

**è§£å†³**:
1. ç‚¹å‡» "ç”Ÿæˆæµ‹è¯•æ•°æ®" æŒ‰é’®
2. ç¡®è®¤æ•°æ®ç”ŸæˆæˆåŠŸåå†æµ‹è¯•

### é—®é¢˜4: ç™»å½•æµ‹è¯•å¤±è´¥

**åŸå› **: Sessionæœªä¿å­˜æˆ–è´¦å·å¯†ç é”™è¯¯

**è§£å†³**:
1. ç¡®è®¤ä½¿ç”¨æ­£ç¡®çš„æµ‹è¯•è´¦å·ï¼ˆadmin/admin123ï¼‰
2. æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦å…è®¸cookies
3. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜åé‡è¯•

## ğŸ“– æœ€ä½³å®è·µ

### 1. æµ‹è¯•å‰å‡†å¤‡

- âœ… ç¡®ä¿åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ
- âœ… å…ˆè¿è¡Œ"å¿«é€ŸéªŒè¯æµ‹è¯•"ç¡®è®¤MockåŠŸèƒ½æ­£å¸¸
- âœ… ç”Ÿæˆè¶³å¤Ÿçš„Mockæ•°æ®ç”¨äºæµ‹è¯•

### 2. æµ‹è¯•æ‰§è¡Œé¡ºåº

1. APIè¿æ¥æµ‹è¯•
2. è®¤è¯æ¨¡å—æµ‹è¯•
3. åŠŸèƒ½æ¨¡å—æµ‹è¯•
4. ç»¼åˆé›†æˆæµ‹è¯•

### 3. è°ƒè¯•æŠ€å·§

- æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·æŸ¥çœ‹Consoleæ—¥å¿—
- æ¯ä¸ªæ¨¡å—çš„test()æ–¹æ³•ä¼šè¾“å‡ºè¯¦ç»†æ—¥å¿—
- ä½¿ç”¨Mockæ•°æ®å¯ä»¥é¿å…æ±¡æŸ“ç”Ÿäº§æ•°æ®

### 4. æµ‹è¯•æŠ¥å‘Š

æµ‹è¯•å®Œæˆåå¯ä»¥ï¼š
- æˆªå›¾ä¿å­˜æµ‹è¯•ç»“æœ
- ä¸‹è½½Mockæ•°æ®ç”¨äºå¤ç°é—®é¢˜
- å¯¼å‡ºæµ‹è¯•æ—¥å¿—ç”¨äºåˆ†æ

## ğŸ”§ å¼€å‘è€…å·¥å…·

### æµè§ˆå™¨Consoleå‘½ä»¤

```javascript
// æŸ¥çœ‹æ‰€æœ‰Mockæ•°æ®
MockDataManager.getData('logRecords')

// æ‰‹åŠ¨è¿è¡Œæµ‹è¯•
MockDataManager.test()
MockAPI.test()
APIClient.test()

// æŸ¥çœ‹APIå®¢æˆ·ç«¯é…ç½®
console.log(APIClient.baseURL)

// è°ƒè¯•ç‰¹å®šåŠŸèƒ½
testAPIConnection()
```

### è‡ªå®šä¹‰Mockæ•°æ®

```javascript
// è‡ªå®šä¹‰æ—¥å¿—è®°å½•
MockDataManager.data.logRecords = [
    {
        id: 1,
        plate_number: 'é—½A88888',
        call_time: '2025-01-17 12:00:00',
        free_parking: true,
        // ...å…¶ä»–å­—æ®µ
    }
];

// æŸ¥çœ‹è‡ªå®šä¹‰æ•°æ®
viewMockData()
```

## ğŸ“ æµ‹è¯•æ¸…å•

### åŠŸèƒ½æµ‹è¯•æ¸…å•

- [ ] APIè¿æ¥æµ‹è¯•é€šè¿‡
- [ ] å¥åº·æ£€æŸ¥æ­£å¸¸
- [ ] ç”¨æˆ·ç™»å½•æˆåŠŸ
- [ ] ç”¨æˆ·ç™»å‡ºæˆåŠŸ
- [ ] æ—¥å¿—æŸ¥è¯¢è¿”å›ç»“æœ
- [ ] è½¦ç‰Œæ¨¡ç³Šæœç´¢æ­£å¸¸
- [ ] æ•°æ®å¯¼å‡ºåŠŸèƒ½æ­£å¸¸
- [ ] Mockæ•°æ®ç”ŸæˆæˆåŠŸ
- [ ] Mock APIè°ƒç”¨æˆåŠŸ
- [ ] ç»¼åˆæµ‹è¯•å…¨éƒ¨é€šè¿‡

### æ€§èƒ½æµ‹è¯•æ¸…å•

- [ ] APIå“åº”æ—¶é—´ < 1ç§’
- [ ] Mockå»¶è¿Ÿè®¾ç½®æ­£ç¡®
- [ ] å¤§é‡æ•°æ®æŸ¥è¯¢ä¸å¡é¡¿
- [ ] æ•°æ®å¯¼å‡ºé€Ÿåº¦åˆç†
- [ ] é¡µé¢åŠ è½½æµç•…

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°æµ‹è¯•é—®é¢˜ï¼š

1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„"å¸¸è§é—®é¢˜æ’æŸ¥"ç« èŠ‚
2. æŸ¥çœ‹æµè§ˆå™¨Consoleçš„é”™è¯¯ä¿¡æ¯
3. æŸ¥çœ‹åç«¯æ—¥å¿—ï¼š`logs/`ç›®å½•
4. å‚è€ƒä¸»é¡¹ç›®æ–‡æ¡£ï¼š`README.md`
5. å‚è€ƒæ•…éšœæ’æŸ¥æ–‡æ¡£ï¼š`TROUBLESHOOTING.md`

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0
**æœ€åæ›´æ–°**: 2025-01-17
**ç»´æŠ¤å›¢é˜Ÿ**: å±±å§†æ—¥å¿—ç³»ç»Ÿå¼€å‘ç»„
